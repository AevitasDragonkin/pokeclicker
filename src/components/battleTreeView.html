<div class="" data-bind="if: App.game.gameState == GameConstants.GameState.battleTree">
    <div class="d-flex flex-column" style="height: 280px; display: block;">

        <h2 class="" style="background-color: rgba(0,0,0,70%); margin: 0;">Battle</h2>

        <!-- ko if: App.game.battleTree.currentRun?.state === BattleTreeRunState.BATTLE && App.game.battleTree.currentRun?.battle -->
        <div class="flex-grow-1" style="display: grid; grid-template-columns: 1fr 1fr; align-items: center; gap: 1rem; padding: 1rem;">
            <div data-bind="with: App.game.battleTree.currentRun?.battle.pokemonA">
                <img src="" alt="" data-bind="attr: { src: PokemonHelper.getImage(PokemonHelper.getPokemonByName($data.name).id) }">
                <div class="progress">
                    <div class="progress-bar bg-danger" role="progressbar" aria-valuemin="0" aria-valuemax="100" data-bind="
                        css: {
                            'bg-success': $data.hitPoints / $data.maxHitPoints >= 0.5,
                            'bg-warning': $data.hitPoints / $data.maxHitPoints >= 0.2 && $data.hitPoints / $data.maxHitPoints < 0.5,
                            'bg-danger': $data.hitPoints / $data.maxHitPoints < 0.2
                        },
                        style: { width: ($data.hitPoints / $data.maxHitPoints).toLocaleString('en-US', { style: 'percent' }) }
                    ">
                        <!-- ko if: $data.hitPoints > 0 -->
                        <span><knockout data-bind="text: $data.hitPoints.toLocaleString('en-US')"></knockout> / <knockout data-bind="text: $data.maxHitPoints.toLocaleString('en-US')"></knockout></span>
                        <!-- /ko -->
                        <!-- ko ifnot: $data.hitPoints > 0 -->
                        <span class="font-italic">Fainted</span>
                        <!-- /ko -->
                    </div>
                </div>
            </div>

            <div data-bind="with: App.game.battleTree.currentRun?.battle.pokemonB">
                <img src="" alt="" data-bind="attr: { src: PokemonHelper.getImage(PokemonHelper.getPokemonByName($data.name).id) }">
                <div class="progress">
                    <div class="progress-bar bg-danger" role="progressbar" aria-valuemin="0" aria-valuemax="100" data-bind="
                        css: {
                            'bg-success': $data.hitPoints / $data.maxHitPoints >= 0.5,
                            'bg-warning': $data.hitPoints / $data.maxHitPoints >= 0.2 && $data.hitPoints / $data.maxHitPoints < 0.5,
                            'bg-danger': $data.hitPoints / $data.maxHitPoints < 0.2
                        },
                        style: { width: ($data.hitPoints / $data.maxHitPoints).toLocaleString('en-US', { style: 'percent' }) }
                    ">
                        <!-- ko if: $data.hitPoints > 0 -->
                        <span><knockout data-bind="text: $data.hitPoints.toLocaleString('en-US')"></knockout> / <knockout data-bind="text: $data.maxHitPoints.toLocaleString('en-US')"></knockout></span>
                        <!-- /ko -->
                        <!-- ko ifnot: $data.hitPoints > 0 -->
                        <span class="font-italic">Fainted</span>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
        </div>
        <!-- /ko -->

        <!-- ko if: App.game.battleTree.currentRun?.state === BattleTreeRunState.FINISHED -->
        <div class="flex-grow-1">
            <div>Stage: <knockout data-bind="text: App.game.battleTree.currentRun.stage"></knockout></div>

            <div>Team</div>
            <div class="d-flex justify-content-center mb-2" style="gap: 1rem;">
                <!-- ko foreach: App.game.battleTree.currentRun.teamA -->
                <div class="card" style="width: 75px; height: 75px;">
                    <div class="card-body p-0 d-flex justify-content-center align-items-center">
                        <img class="w-100 h-100" src="" alt="" data-bind="attr: { src: PokemonHelper.getImage(PokemonHelper.getPokemonByName($data.name).id) }">
                    </div>
                </div>
                <!-- /ko -->
            </div>
        </div>
        <!-- /ko -->

        <!-- ko if: App.game.battleTree.currentRun?.state === BattleTreeRunState.MODIFIER -->
        <!-- /ko -->

        <!-- ko if: App.game.battleTree.currentRun -->
        <h2 class="" style="background-color: rgba(0,0,0,70%); margin: 0; font-size: 1rem;">
            <knockout>
                Stage <knockout data-bind="text: App.game.battleTree.currentRun.stage"></knockout> - <code data-bind="text: GameConstants.formatSecondsToTime(App.game.battleTree.currentRun.combatTime)"></code>
            </knockout>
        </h2>
        <!-- /ko -->
    </div>
</div>
