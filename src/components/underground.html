<div aria-labelledby="myModalLabel" class="modal fade noselect" id="mineModal" role="dialog"
     style="cursor:default" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header p-0">
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#dig">Dig</a></li>
                    <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#treasures">Treasures</a></li>
                    <li class="nav-item"><a data-toggle='tab' class='nav-link' href="#undergroundHelpers">Helpers</a></li>
                    <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#help">Help</a></li>
                    <li class="d-block"><button type="button" class="btn btn-danger" data-dismiss="modal" style="font-size: 18px; font-weight: 700;">×</button></li>
                </ul>
            </div>
            <div class="modal-body tab-content p-0">
                <div id="dig" class="tab-pane fade in active show" data-bind="">
                    <div class="container">
                        <div class="row p-2">
                            <div class="col-6 p-0 d-flex">
                                <button class="btn btn-primary" data-bind="click: () => $('#findNewMineModal').modal('show');">Find mine</button>

                                <!-- ko let: { autoRestartUndergroundMine: Settings.getSetting('autoRestartUndergroundMine') } -->
                                <button class="btn btn-danger p-2" style="min-width: 36px;" data-bind="
                                    text: `↻ ${autoRestartUndergroundMine.observableValue() ? 'On' : 'Off'}`,
                                    css: {
                                        'btn-danger': !autoRestartUndergroundMine.observableValue(),
                                        'btn-success': autoRestartUndergroundMine.observableValue()
                                    },
                                    tooltip: {
                                        title: `${autoRestartUndergroundMine.displayName}: ${autoRestartUndergroundMine.observableValue() ? 'On' : 'Off'}`,
                                        trigger: 'hover',
                                        placement:'right'
                                    },
                                    click: () => autoRestartUndergroundMine.observableValue(!autoRestartUndergroundMine.observableValue())"></button>
                                <!-- /ko -->
                            </div>

                            <div class="col-6 p-0" data-bind="tooltip: {
                                    title: `${(App.game.underground.undergroundExp - Underground.convertLevelToExperience(App.game.underground.undergroundLevel)).toLocaleString('en-US')} / ${(Underground.convertLevelToExperience(App.game.underground.undergroundLevel + 1) - Underground.convertLevelToExperience(App.game.underground.undergroundLevel)).toLocaleString('en-US')}`,
                                    trigger: 'hover'
                                }">
                                <div>Lvl. <knockout data-bind="text: App.game.underground.undergroundLevel"></knockout></div>
                                <div class="progress" style='height: 5px'>
                                    <div class="progress-bar bg-info" role="progressbar"
                                         data-bind="attr:{ style: 'width:' + App.game.underground.progressToNextLevel.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }) }"
                                         aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="card">
                            <div class="card-header p-2 font-weight-bold">Treasures</div>
                            <div class="card-body p-2 d-flex justify-content-center" style="gap: 1.5rem">
                                <!-- ko if: !App.game.underground.mine || App.game.underground.mine.timeUntilDiscovery > 0 -->
                                <div>Found • ??</div>
                                <div>Seen • ??</div>
                                <div>Buried • ??</div>
                                <!-- /ko -->

                                <!-- ko ifnot: !App.game.underground.mine || App.game.underground.mine.timeUntilDiscovery > 0 -->
                                <div class="" data-bind="css: { 'text-warning': App.game.underground.mine?.itemsFound > 0 && App.game.underground.mine?.itemsFound < App.game.underground.mine?.itemsBuried, 'text-success': App.game.underground.mine?.itemsFound === App.game.underground.mine?.itemsBuried }">
                                    Found • <knockout data-bind="text: App.game.underground.mine?.itemsFound"></knockout>
                                </div>
                                <div class="" data-bind="css: { 'text-warning': App.game.underground.mine?.itemsPartiallyFound > 0 && App.game.underground.mine?.itemsPartiallyFound < App.game.underground.mine?.itemsBuried, 'text-success': App.game.underground.mine?.itemsPartiallyFound === App.game.underground.mine?.itemsBuried }">
                                    Seen • <knockout data-bind="text: App.game.underground.mine?.itemsPartiallyFound"></knockout>
                                </div>
                                <div class="">
                                    Buried • <knockout data-bind="text: App.game.underground.mine?.itemsBuried"></knockout>
                                </div>
                                <!-- /ko -->
                            </div>
                        </div>

                        <!-- ko if: App.game.underground.mine -->
                        <div style="position: relative;">
                            <div id="mineBody" style="margin:auto; background-image: url('../assets/images/underground/rock0.png');"
                                 data-bind="css: { 'disabled': App.game.underground.mine.timeUntilDiscovery > 0 || App.game.underground.mine.completed },
                                 class: `${UndergroundToolType[App.game.undergroundTools.selectedToolType]}Selected`,
                                 style: {
                                    backgroundSize: `calc(100% / ${App.game.underground.mine?.columnCount})`,
                                 }">
                                <!-- ko foreach: App.game.underground.mine.grid -->
                                <div class="mineSquare" data-bind="click: () => { UndergroundController.clickModalMineSquare($index()); }">
                                    <div class="rock" data-bind="class: `rock${$data.layerDepth}`, style: UndergroundController.calculateMineTileStyle($index())"></div>

                                    <!-- ko if: $data.survey > 0 -->
                                    <div class="survey" data-bind="class: `survey-${$data.survey}`"></div>
                                    <!-- /ko -->
                                </div>
                                <!-- /ko -->
                            </div>

                            <!-- ko if: App.game.underground.mine && App.game.underground.mine.timeUntilDiscovery > 0 -->
                            <div style="position: absolute; inset: 20%; display: grid; align-content: center;">
                                <div>Searching for mine</div>
                                <div class="progress" style='height: 5px'>
                                    <div class="progress-bar bg-info" role="progressbar"
                                         data-bind="attr:{ style: 'width:' + (1 - App.game.underground.mine.timeUntilDiscovery / App.game.underground.mine.initialTimeToDiscover).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }) }"
                                         aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                                <div data-bind="text: GameConstants.formatTime(App.game.underground.mine.timeUntilDiscovery)"></div>
                            </div>
                            <!-- /ko -->
                        </div>

                        <div class='row no-gutters'>
                            <div class="col-12 row no-gutters">
                                <!-- ko foreach: [UndergroundToolType.Chisel, UndergroundToolType.Hammer, UndergroundToolType.Bomb, UndergroundToolType.Survey] -->
                                <!-- ko let: { tool: App.game.undergroundTools.getTool($data) } -->
                                <div class="tool-ui col card clickable" data-bind="class: `${UndergroundToolType[$data]}-tool-ui`, css: { 'border-info': App.game.undergroundTools.selectedToolType === $data }, click: () => App.game.undergroundTools.selectedToolType = $data">
                                    <div class="card-header p-1" data-bind="css: { 'bg-info': App.game.undergroundTools.selectedToolType === $data }">
                                        <div data-bind="text: tool.displayName"></div>
                                    </div>
                                    <div class="card-body d-flex flex-column p-0 rounded text-center">
                                        <div class="p-1 d-flex justify-content-center">
                                            <div style="position: relative; width: 100%; max-width: 75px; aspect-ratio: 1; padding: 5px; border-radius: 10px;" data-bind="style: { background: `conic-gradient(transparent ${(1 - (tool.cooldownForDisplay() / tool.cooldownTime)).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 })}, var(--tool-color) 0)` }">
                                                <div class="bg-secondary" style="width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 5px;">
                                                    <div style="width: 27px; height: 27px; display: flex; align-items: center; justify-content: center;">
                                                        <img alt="" data-bind="attr: { src: `../assets/images/underground/${UndergroundToolType[tool.id]}.png` }, style: { opacity: tool.cooldownForDisplay() > 0 ? 0.3 : 1 }">
                                                    </div>
                                                    <div class="small" data-bind="text: tool.cooldownForDisplay().toLocaleString('en-US', { minimumSignificantDigits: 2, maximumFractionDigits: 1, roundingPriority: 'lessPrecision' }), style: { opacity: tool.cooldownForDisplay() === 0 ? 0.3 : 1 }"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="text-center text-light bg-dark p-1"><h6 class="m-0 small">Bonus Charge</h6></div>
                                        <!-- ko if: tool.maximumStoredUsages > 0 -->
                                        <div><knockout data-bind="text: tool.storedUses"></knockout> / <knockout data-bind="text: tool.maximumStoredUsages"></knockout></div>
                                        <div class="small"><knockout data-bind="text: (tool.counter / tool.baseCooldown).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout></div>
                                        <div class="progress" style='height: 10px; min-height: 10px;'>
                                            <div class="progress-bar" role="progressbar" style="background: var(--tool-color)"
                                                 data-bind="style: { 'width': (tool.counter / tool.baseCooldown).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }"
                                                 aria-valuemin="0" aria-valuemax="100">
                                            </div>
                                        </div>
                                        <!-- /ko -->
                                        <!-- ko ifnot: tool.maximumStoredUsages > 0 -->
                                        <div class="d-flex justify-content-center align-items-center" style="flex: 1;">N/A</div>
                                        <!-- /ko -->
                                    </div>

                                    <div class="card-footer p-0">
                                    </div>
                                </div>
                                <!-- /ko -->
                                <!-- /ko -->
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>
                </div>

                <div id="treasures" class="tab-pane fade p-2">
                    <!-- ko foreach: [UndergroundItemValueType.Diamond, UndergroundItemValueType.Gem, UndergroundItemValueType.Shard, UndergroundItemValueType.Fossil, UndergroundItemValueType.FossilPiece, UndergroundItemValueType.EvolutionItem, UndergroundItemValueType.Special] -->
                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold" data-bind="text: GameConstants.camelCaseToString(GameHelper.enumStrings(UndergroundItemValueType)[$data])"></span>
                        </div>

                        <div class="card-body">
                            <div class="row">
                                <!-- ko foreach: UndergroundItems.list.filter(item => item.valueType === $data) -->
                                <div class="col-6 col-lg-3 mb-2" data-bind="visible: $data.isUnlocked()">
                                    <div class="btn btn-secondary text-left w-100 px-1" style="cursor: default; padding-top: 1px; padding-bottom: 2px;"
                                         data-bind="
                                            css: { 'bg-info': UndergroundTrading.selectedTradeFromItem === $data },
                                            template: { name: 'otherItemTemplate', data: $data.itemName },
                                            click: () => {
                                                UndergroundTrading.selectedTradeFromItem = $data;
                                                UndergroundTrading.selectedTradeToItem = UndergroundTrading.tradeToItemList[0];
                                                $('#treasureDetailModal').modal('show');
                                            }
                                         ">
                                    </div>
                                </div>
                                <!-- /ko -->
                            </div>
                        </div>
                    </div>
                    <!-- /ko -->
                </div>

                <div id="undergroundHelpers" class="tab-pane fade">
                    <div class="row m-0 justify-content-start" data-bind="foreach: App.game.underground.helpers.available()" style="max-width: 100%;">
                        <div class="card text-left col-md-3 col-sm-6 col-xs-12 p-0">
                            <h5 class="card-header">
                                <knockout data-bind="text: $data.name">Name</knockout>
                            </h5>
                            <div class="card-body p-0">
                                <table class="table table-striped table-hover table-bordered table-sm m-0">
                                    <thead>
                                    <tr>
                                        <th colspan="2" class="text-center text-light bg-dark"><h5 class="m-0">Information</h5></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td class="text-left">Level</td>
                                        <td class="text-right tight" data-bind="text: $data.level.toLocaleString('en-US')"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Experience</td>
                                        <td class="text-right tight" data-bind="text: $data.experience.toLocaleString('en-US')"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Auto-sell</td>
                                        <td class="text-right tight" data-bind="text: $data.autoSellValue.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Smart tool</td>
                                        <td class="text-right tight" data-bind="text: $data.smartToolUsageChance.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Favorite mine</td>
                                        <td class="text-right tight" data-bind="text: $data.favoriteMine"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Discover chance</td>
                                        <td class="text-right tight" data-bind="text: $data.favoriteMineChance.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Work cycle</td>
                                        <td class="text-right tight" data-bind="text: `${$data.workCycleTime.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })}s`"></td>
                                    </tr>
                                    </tbody>

                                    <thead>
                                    <tr>
                                        <th colspan="2" class="text-center text-light bg-dark"><h5 class="m-0">Energy Restore</h5></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td colspan="2">
                                            <div class="input-group input-group-sm">
                                                <select autocomplete="off" class="custom-select" data-bind="options: [
                                                    { name: 'None', value: -1 },
                                                    ...GameHelper.enumSelectOption(GameConstants.EnergyRestoreSize),
                                                ], optionsValue: 'value', optionsText: (item) => item.value < 0 ? `${GameConstants.camelCaseToString(item.name)}` : `${GameConstants.camelCaseToString(item.name)} (${player.itemList[item.name]().toLocaleString('en-US')})`, value: $data.selectedEnergyRestore"></select>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="card-footer p-0">
                                <button class="btn btn-block" data-bind="attr: { disabled: !$data.hired && !App.game.underground.helpers.canHire() }, css: { 'btn-success': !$data.hired, 'btn-danger': $data.hired }, click: () => !$data.hired ? $data.hire() : $data.fire(), text: !$data.hired ? 'Hire!' : 'Fire!'">Hire!</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="help" class="tab-pane fade pl-5 pr-5">
                    <h4><u>Dig</u></h4>
                    <p>In the Underground you can mine for hidden treasures.</p>

                    <p>There are three main ways of breaking tiles:
                    <br/>Chisel will mine 2 layers on a single tile.
                    <br/>Hammer will mine 1 layer on all nine tiles of a 3x3 square.
                    <br/>Bomb will mine 2 layers of 10 random tiles.</p>

                    <h4><u>Treasures</u></h4>
                    <p>Sell your treasures for gems or diamonds!</p>
                    <p>If you have found any fossils, you can hatch the Pokémon they contain from the Treasures tab, or from the Day Care.</p>

                    <h4><u>Daily deals</u></h4>
                    <p>In the Daily deals tab you can trade your items. The trades available change each day at midnight.</p>
                </div>
            </div>

            <div class="modal-footer p-0">
                <div class="container">
                    <div class="row p-0">
                        <!-- ko foreach: App.game.underground.helpers.hired() -->
                        <div class="col p-0">
                            <div>
                                <span data-bind="text: $data.name"></span>
                                <!-- ko ifnot: $data.selectedEnergyRestore < 0 -->
                                <span data-bind="text: ` using ${GameConstants.camelCaseToString(GameConstants.EnergyRestoreSize[$data.selectedEnergyRestore])} (${player.itemList[GameConstants.EnergyRestoreSize[$data.selectedEnergyRestore]]().toLocaleString('en-US')})`"></span>
                                <!-- /ko -->
                            </div>
                            <div class="progress" style='height: 5px'>
                                <div class="progress-bar bg-info" role="progressbar"
                                     data-bind="attr:{ style: 'width:' + ($data.timeSinceWork / $data.workCycleTime).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }"
                                     aria-valuemin="0" aria-valuemax="100">
                                </div>
                            </div>
                            <div data-bind="text: `${$data.timeSinceWork.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })} / ${$data.workCycleTime.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })}s`"></div>
                        </div>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/html" id="treasureListTemplate">
        <tr>
        </tr>
    </script>
</div>

<div aria-labelledby="mineSellAllTreasuresModalLabel" class="modal fade noselect" id="mineSellAllTreasuresModal" role="dialog"
     style="cursor:default" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-sm" role="document" data-bind="let: { filteredMineInventory: UndergroundItems.list.filter(item => item.hasSellValue() && player.itemList[item.itemName]()) }">
        <div class="modal-content">
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>

    <script type="text/html" id="cumulativeValueListTemplate">
        <tr></tr>
    </script>
</div>

<div aria-labelledby="findNewMineModalLabel" class="modal fade no-select" id="findNewMineModal" role="dialog" style="cursor: default;" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <h4>Select a mine</h4>
                <div class="search-mine-display mb-2">
                    <!-- ko foreach: [MineType.Random, MineType.Diamond, MineType.GemPlate, MineType.Shard, MineType.Fossil, MineType.EvolutionItem] -->
                    <div class="mx-1 mb-1">
                        <div class="card clickable" data-bind="click: () => { App.game.underground.autoSearchMineType = $data; }">
                            <div class="card-body bg-secondary rounded text-center p-1" data-bind="css: { 'bg-info': App.game.underground.autoSearchMineType === $data }">
                                <div class="d-flex flex-column align-items-center">
                                    <h6 class="card-title m-0" data-bind="text: UndergroundController.getMineConfig($data).displayName"></h6>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /ko -->
                </div>

                <div class="card mb-2">
                    <div class="card-header d-flex align-items-center p-0">
                        <span class="flex-grow-1 text-center font-weight-bold" data-bind="text: UndergroundController.getMineConfig(App.game.underground.autoSearchMineType).displayName"></span>
                    </div>

                    <div class="card-body">
                        <div class="mb-3">
                            Discovery time: <knockout data-bind="text: GameConstants.formatTime(UndergroundController.calculateDiscoverMineTimeout(App.game.underground.autoSearchMineType))"></knockout>
                        </div>

                        <h6>Potential treasures</h6>
                        <div>
                            <!-- ko foreach: UndergroundController.getMineConfig(App.game.underground.autoSearchMineType).getAvailableItems() -->
                            <img width="24px" height="24px" data-bind="tooltip: { title: $data.displayName, trigger: 'hover' }, attr: { src: $data.image }" />
                            <!-- /ko -->
                        </div>
                    </div>

                    <div class="card-footer">
                        <button class="btn btn-primary" data-bind="click: () => App.game.underground.generateMine(App.game.underground.autoSearchMineType);" data-dismiss="modal">Search for mine</button>
                    </div>
                </div>

                <div>
                    <!-- ko let: { autoRestartUndergroundMine: Settings.getSetting('autoRestartUndergroundMine') } -->
                    <label for="auto-restart-underground-mine" data-bind="text: autoRestartUndergroundMine.displayName"></label>
                    <label class="form-check-label toggler-wrapper style-1 float-right">
                        <input class="form-check-input" type="checkbox" id="auto-restart-underground-mine"
                               data-bind="checked: autoRestartUndergroundMine.observableValue">
                        <div class="toggler-slider">
                            <div class="toggler-knob"></div>
                        </div>
                    </label>
                    <!-- /ko -->
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

<div aria-labelledby="treasureDetailModalLabel" class="modal fade no-select" id="treasureDetailModal" role="dialog" style="cursor: default;" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header align-items-center">
                <!-- ko if: UndergroundTrading.selectedTradeFromItem -->
                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                <div>
                    <h4 class="m-0" data-bind="text: UndergroundTrading.selectedTradeFromItem.name"></h4>
                    <small class="m-0" data-bind="text: player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]().toLocaleString('en-US')"></small>
                </div>
                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                <!-- /ko -->
            </div>

            <div class="modal-body">
                <!-- ko if: UndergroundTrading.selectedTradeFromItem?.hasSellValue() -->
                <div class="card mb-2">
                    <div class="card-header d-flex align-items-center p-0">
                        <span class="flex-grow-1 text-center font-weight-bold">Sell</span>
                    </div>

                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 col-lg-3 font-weight-bold" data-bind="css: { 'text-danger': UndergroundTrading.sellAmount > player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() }">
                                <label data-bind="text: UndergroundTrading.sellAmount.toLocaleString('en-US')"></label>
                            </div>
                            <div class="col-12 col-lg-6">
                                <label data-bind="text: UndergroundTrading.selectedTradeFromItem.name"></label>
                                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                                →
                                <!-- ko if: UndergroundTrading.selectedTradeFromItem.valueType === UndergroundItemValueType.Gem -->
                                <img class='mineInventoryItem' data-bind='attr: { src: Gems.image(UndergroundTrading.selectedTradeFromItem.type) }'/>
                                <label data-bind="text: `${UndergroundTrading.selectedTradeFromItem.value.toLocaleString('en-US')} × ${PokemonType[UndergroundTrading.selectedTradeFromItem.type]} Gems`"></label>
                                <!-- /ko -->
                                <!-- ko if: UndergroundTrading.selectedTradeFromItem.valueType === UndergroundItemValueType.Diamond -->
                                <img class='mineInventoryItem' src="../assets/images/currency/diamond.svg"/>
                                <label data-bind="text: `${UndergroundTrading.selectedTradeFromItem.value.toLocaleString('en-US')} × Diamonds`"></label>
                                <!-- /ko -->
                            </div>
                            <div class="col-12 col-lg-3 font-weight-bold">
                                <label data-bind="text: (UndergroundTrading.sellAmount * UndergroundTrading.selectedTradeFromItem.value).toLocaleString('en-US')"></label>
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <div class="row">
                            <div class="col-12 col-lg-9 mb-2 mb-lg-0">
                                <div class="input-group">
                                    <button class="btn btn-warning btn-outline-dark smallButton smallFont" data-bind="click: () => UndergroundTrading.sellAmount = 1">Reset</button>

                                    <input type="number" class="outline-dark form-control form-control-number" data-bind="textInput: UndergroundTrading.sellAmount">

                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'original' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 10">
                                        +10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 100">
                                        +100
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'multiplication' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount *= 10">
                                        &times;10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount /= 10">
                                        &div;10
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'bigplus' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 100">
                                        +100
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 1000">
                                        +1,000
                                    </button>
                                    <!-- /ko -->

                                    <button class="btn btn-outline-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                                    <div class="dropdown-menu text-center p-0">
                                        <p class="small py-2 m-0">Set Trade Amount</p>
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [10, 100, 1000] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US')}`,
                                            click: () => { UndergroundTrading.sellAmount = $data }
                                        "></button>
                                        <!-- /ko -->
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [0.1, 0.25, 0.5, 0.75, 1] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US', { style: 'percent' })}`,
                                            click: () => { UndergroundTrading.sellAmount = player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() * $data }
                                        "></button>
                                        <!-- /ko -->
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-lg-3">
                                <button class="btn btn-block btn-primary" data-bind="
                                    enable: UndergroundTrading.canSell,
                                    click: () => UndergroundTrading.sell()
                                ">Sell</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /ko -->

                <!-- ko if: UndergroundTrading.tradeToItemList?.length > 0 -->
                <div class="card mb-2">
                    <div class="card-header d-flex align-items-center p-0">
                        <span class="flex-grow-1 text-center font-weight-bold">Trade</span>
                    </div>

                    <div class="card-body">
                        <div class="row">
                            <!-- ko foreach: UndergroundTrading.tradeToItemList -->
                            <div class="col-6 col-lg-3 mb-2" data-bind="visible: $data.isUnlocked()">
                                <div class="btn btn-secondary text-left w-100 px-1" style="cursor: default; padding-top: 1px; padding-bottom: 2px;"
                                     data-bind="
                                        css: { 'bg-info': UndergroundTrading.selectedTradeToItem === $data },
                                        template: { name: 'otherItemTemplate', data: $data.itemName },
                                        click: () => { UndergroundTrading.selectedTradeToItem = $data; }
                                     ">
                                </div>
                            </div>
                            <!-- /ko -->
                        </div>

                        <hr>

                        <div class="row">
                            <div class="col-12 col-lg-3 font-weight-bold" data-bind="css: { 'text-danger': UndergroundTrading.tradeFromAmount > player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() }">
                                <label data-bind="text: UndergroundTrading.tradeFromAmount.toLocaleString('en-US')"></label>
                            </div>
                            <div class="col-12 col-lg-6">
                                <label data-bind="text: UndergroundTrading.selectedTradeFromItem.name"></label>
                                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                                →
                                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeToItem?.image || null }'>
                                <label data-bind="text: UndergroundTrading.selectedTradeToItem?.name || '???'"></label>
                            </div>
                            <div class="col-12 col-lg-3 font-weight-bold">
                                <label data-bind="text: UndergroundTrading.tradeAmount.toLocaleString('en-US')"></label>
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <div class="row">
                            <div class="col-12 col-lg-9 mb-2 mb-lg-0">
                                <div class="input-group">
                                    <button class="btn btn-warning btn-outline-dark smallButton smallFont" data-bind="click: () => UndergroundTrading.tradeAmount = 1">Reset</button>

                                    <input type="number" class="outline-dark form-control form-control-number" data-bind="textInput: UndergroundTrading.tradeAmount">

                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'original' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 10">
                                        +10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 100">
                                        +100
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'multiplication' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount *= 10">
                                        &times;10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount /= 10">
                                        &div;10
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'bigplus' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 100">
                                        +100
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 1000">
                                        +1,000
                                    </button>
                                    <!-- /ko -->

                                    <button class="btn btn-outline-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                                    <div class="dropdown-menu text-center p-0">
                                        <p class="small py-2 m-0">Set Trade Amount</p>
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [10, 100, 1000] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US')}`,
                                            click: () => { UndergroundTrading.tradeAmount = $data }
                                        "></button>
                                        <!-- /ko -->
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [0.1, 0.25, 0.5, 0.75, 1] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US', { style: 'percent' })}`,
                                            click: () => { UndergroundTrading.tradeFromAmount = player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() * $data }
                                        "></button>
                                        <!-- /ko -->
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-lg-3">
                                <button class="btn btn-block btn-primary" data-bind="
                                    enable: UndergroundTrading.canTrade,
                                    click: () => UndergroundTrading.trade()
                                ">Trade</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /ko -->
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
