<div aria-labelledby="myModalLabel" class="modal fade noselect" id="mineModal" role="dialog"
     style="cursor:default" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header p-0">
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#dig">Dig</a></li>
                    <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#treasures">Treasures</a></li>
                    <li class="nav-item"><a data-toggle='tab' class='nav-link' href="#undergroundHelpers">Helpers</a></li>
                    <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#help">Help</a></li>
                    <li class="d-block"><button type="button" class="btn btn-danger" data-dismiss="modal" style="font-size: 18px; font-weight: 700;">×</button></li>
                </ul>
            </div>
            <div class="modal-body tab-content p-0">
                <div id="dig" class="tab-pane fade in active show" data-bind="">
                    <div class="container">
                        <div class="row p-2">
                            <div class="col-6 p-0 d-flex">
                                <button class="btn btn-primary" data-bind="click: () => $('#findNewMineModal').modal('show');">Find mine</button>

                                <!-- ko let: { autoRestartUndergroundMine: Settings.getSetting('autoRestartUndergroundMine') } -->
                                <button class="btn btn-danger p-2" style="min-width: 36px;" data-bind="
                                    text: `↻ ${autoRestartUndergroundMine.observableValue() ? 'On' : 'Off'}`,
                                    css: {
                                        'btn-danger': !autoRestartUndergroundMine.observableValue(),
                                        'btn-success': autoRestartUndergroundMine.observableValue()
                                    },
                                    tooltip: {
                                        title: `${autoRestartUndergroundMine.displayName}: ${autoRestartUndergroundMine.observableValue() ? 'On' : 'Off'}`,
                                        trigger: 'hover',
                                        placement:'right'
                                    },
                                    click: () => autoRestartUndergroundMine.observableValue(!autoRestartUndergroundMine.observableValue())"></button>
                                <!-- /ko -->
                            </div>

                            <div class="col-6 p-0" data-bind="tooltip: {
                                    title: `${(App.game.underground.undergroundExp - Underground.convertLevelToExperience(App.game.underground.undergroundLevel)).toLocaleString('en-US')} / ${(Underground.convertLevelToExperience(App.game.underground.undergroundLevel + 1) - Underground.convertLevelToExperience(App.game.underground.undergroundLevel)).toLocaleString('en-US')}`,
                                    trigger: 'hover'
                                }">
                                <div>Lvl. <knockout data-bind="text: App.game.underground.undergroundLevel"></knockout></div>
                                <div class="progress" style='height: 5px'>
                                    <div class="progress-bar bg-info" role="progressbar"
                                         data-bind="attr:{ style: 'width:' + App.game.underground.progressToNextLevel.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }) }"
                                         aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="card">
                            <div class="card-header p-2 font-weight-bold">Treasures</div>
                            <div class="card-body p-2 d-flex justify-content-center" style="gap: 1.5rem">
                                <!-- ko if: !App.game.underground.mine || App.game.underground.mine.timeUntilDiscovery > 0 -->
                                <div>Found • ??</div>
                                <div>Seen • ??</div>
                                <div>Buried • ??</div>
                                <!-- /ko -->

                                <!-- ko ifnot: !App.game.underground.mine || App.game.underground.mine.timeUntilDiscovery > 0 -->
                                <div class="" data-bind="css: { 'text-warning': App.game.underground.mine?.itemsFound > 0 && App.game.underground.mine?.itemsFound < App.game.underground.mine?.itemsBuried, 'text-success': App.game.underground.mine?.itemsFound === App.game.underground.mine?.itemsBuried }">
                                    Found • <knockout data-bind="text: App.game.underground.mine?.itemsFound"></knockout>
                                </div>
                                <div class="" data-bind="css: { 'text-warning': App.game.underground.mine?.itemsPartiallyFound > 0 && App.game.underground.mine?.itemsPartiallyFound < App.game.underground.mine?.itemsBuried, 'text-success': App.game.underground.mine?.itemsPartiallyFound === App.game.underground.mine?.itemsBuried }">
                                    Seen • <knockout data-bind="text: App.game.underground.mine?.itemsPartiallyFound"></knockout>
                                </div>
                                <div class="">
                                    Buried • <knockout data-bind="text: App.game.underground.mine?.itemsBuried"></knockout>
                                </div>
                                <!-- /ko -->
                            </div>
                        </div>

                        <!-- ko if: App.game.underground.mine -->
                        <div style="position: relative;">
                            <div id="mineBody" style="margin:auto; background-image: url('../assets/images/underground/rock0.png');"
                                 data-bind="css: { 'disabled': App.game.underground.mine.timeUntilDiscovery > 0 || App.game.underground.mine.completed },
                                 class: `${UndergroundToolType[App.game.undergroundTools.selectedToolType]}Selected`,
                                 style: {
                                    backgroundSize: `calc(100% / ${App.game.underground.mine?.columnCount})`,
                                 }">
                                <!-- ko foreach: App.game.underground.mine.grid -->
                                <div class="mineSquare" data-bind="click: () => { UndergroundController.clickModalMineSquare($index()); }">
                                    <div class="rock" data-bind="class: `rock${$data.layerDepth}`, style: UndergroundController.calculateMineTileStyle($index())"></div>

                                    <!-- ko if: $data.survey > 0 -->
                                    <div class="survey" data-bind="class: `survey-${$data.survey}`"></div>
                                    <!-- /ko -->
                                </div>
                                <!-- /ko -->
                            </div>

                            <!-- ko if: App.game.underground.mine && App.game.underground.mine.timeUntilDiscovery > 0 -->
                            <div style="position: absolute; inset: 20%; display: grid; align-content: center;">
                                <div>Searching for mine</div>
                                <div class="progress" style='height: 5px'>
                                    <div class="progress-bar bg-info" role="progressbar"
                                         data-bind="attr:{ style: 'width:' + (1 - App.game.underground.mine.timeUntilDiscovery / App.game.underground.mine.initialTimeToDiscover).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }) }"
                                         aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                                <div data-bind="text: GameConstants.formatTime(App.game.underground.mine.timeUntilDiscovery)"></div>
                            </div>
                            <!-- /ko -->
                        </div>

                        <div class='row no-gutters'>
                            <div class="col-12 row no-gutters">
                                <!-- ko foreach: [UndergroundToolType.Chisel, UndergroundToolType.Hammer, UndergroundToolType.Bomb, UndergroundToolType.Survey] -->
                                <!-- ko let: { tool: App.game.undergroundTools.getTool($data) } -->
                                <div class="tool-ui col card clickable" data-bind="class: `${UndergroundToolType[$data]}-tool-ui`, css: { 'border-info': App.game.undergroundTools.selectedToolType === $data }, click: () => App.game.undergroundTools.selectedToolType = $data">
                                    <div class="card-header p-1" data-bind="css: { 'bg-info': App.game.undergroundTools.selectedToolType === $data }">
                                        <div data-bind="text: tool.displayName"></div>
                                    </div>
                                    <div class="card-body d-flex flex-column p-0 rounded text-center">
                                        <div class="p-1 d-flex justify-content-center">
                                            <div style="position: relative; width: 100%; max-width: 75px; aspect-ratio: 1; padding: 5px; border-radius: 10px;" data-bind="style: { background: `conic-gradient(transparent ${(1 - (tool.cooldownForDisplay() / tool.cooldownTime)).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 })}, var(--tool-color) 0)` }">
                                                <div class="bg-secondary" style="width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 5px;">
                                                    <div style="width: 27px; height: 27px; display: flex; align-items: center; justify-content: center;">
                                                        <img alt="" data-bind="attr: { src: `../assets/images/underground/${UndergroundToolType[tool.id]}.png` }, style: { opacity: tool.cooldownForDisplay() > 0 ? 0.3 : 1 }">
                                                    </div>
                                                    <div class="small" data-bind="text: tool.cooldownForDisplay().toLocaleString('en-US', { minimumSignificantDigits: 2, maximumFractionDigits: 1, roundingPriority: 'lessPrecision' }), style: { opacity: tool.cooldownForDisplay() === 0 ? 0.3 : 1 }"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="text-center text-light bg-dark p-1"><h6 class="m-0 small">Bonus Charge</h6></div>
                                        <!-- ko if: tool.maximumBonusCharges > 0 -->
                                        <div><knockout data-bind="text: tool.bonusCharges"></knockout> / <knockout data-bind="text: tool.maximumBonusCharges"></knockout></div>
                                        <div class="small" data-bind="style: { opacity: tool.bonusCharges >= tool.maximumBonusCharges ? 0.3 : 1 }"><knockout data-bind="text: (tool.counter / tool.baseCooldown).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout></div>
                                        <div class="progress" style='height: 10px; min-height: 10px;' data-bind="style: { opacity: tool.bonusCharges >= tool.maximumBonusCharges ? 0.3 : 1 }">
                                            <div class="progress-bar" role="progressbar" style="background: var(--tool-color)"
                                                 data-bind="style: { 'width': (tool.counter / tool.baseCooldown).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }"
                                                 aria-valuemin="0" aria-valuemax="100">
                                            </div>
                                        </div>
                                        <!-- /ko -->
                                        <!-- ko ifnot: tool.maximumBonusCharges > 0 -->
                                        <div class="d-flex justify-content-center align-items-center" style="flex: 1;">N/A</div>
                                        <!-- /ko -->
                                    </div>

                                    <div class="card-footer p-0">
                                    </div>
                                </div>
                                <!-- /ko -->
                                <!-- /ko -->
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>
                </div>

                <div id="treasures" class="tab-pane fade p-2">
                    <!-- ko foreach: [UndergroundItemValueType.Diamond, UndergroundItemValueType.Gem, UndergroundItemValueType.Shard, UndergroundItemValueType.Fossil, UndergroundItemValueType.FossilPiece, UndergroundItemValueType.EvolutionItem, UndergroundItemValueType.Special] -->
                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold" data-bind="text: GameConstants.camelCaseToString(GameHelper.enumStrings(UndergroundItemValueType)[$data])"></span>
                        </div>

                        <div class="card-body">
                            <div class="row">
                                <!-- ko foreach: UndergroundItems.list.filter(item => item.valueType === $data) -->
                                <div class="col-6 col-lg-3 mb-2" data-bind="visible: $data.isUnlocked()">
                                    <div class="btn btn-secondary text-left w-100 px-1" style="cursor: default; padding-top: 1px; padding-bottom: 2px;"
                                         data-bind="
                                            css: { 'bg-info': UndergroundTrading.selectedTradeFromItem === $data },
                                            template: { name: 'otherItemTemplate', data: $data.itemName },
                                            click: () => {
                                                UndergroundTrading.selectedTradeFromItem = $data;
                                                UndergroundTrading.selectedTradeToItem = UndergroundTrading.tradeToItemList[0];
                                                $('#treasureDetailModal').modal('show');
                                            }
                                         ">
                                    </div>
                                </div>
                                <!-- /ko -->
                            </div>
                        </div>
                    </div>
                    <!-- /ko -->
                </div>

                <div id="undergroundHelpers" class="tab-pane fade">
                    <div class="row m-0 justify-content-start" data-bind="foreach: App.game.underground.helpers.available()" style="max-width: 100%;">
                        <div class="card text-left col-md-4 col-sm-6 col-xs-12 p-0">
                            <h5 class="card-header">
                                <knockout data-bind="text: $data.name">Name</knockout>
                            </h5>
                            <div class="card-body p-0">
                                <table class="table table-striped table-hover table-bordered table-sm m-0">
                                    <thead>
                                    <tr>
                                        <th colspan="2" class="text-center text-light bg-dark"><h5 class="m-0">Information</h5></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td class="text-left">Level</td>
                                        <td class="text-right tight" data-bind="text: $data.level.toLocaleString('en-US')"></td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <div class="progress" style='height: 5px'>
                                                <div class="progress-bar bg-info" role="progressbar"
                                                     data-bind="style: { 'width': $data.progressToNextLevel.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }) }"
                                                     aria-valuemin="0" aria-valuemax="100">
                                                    <span data-bind="text: `${($data.experience - UndergroundHelper.convertLevelToExperience($data.level)).toLocaleString('en-US')} / ${(UndergroundHelper.convertLevelToExperience($data.level + 1) - UndergroundHelper.convertLevelToExperience($data.level)).toLocaleString('en-US')}`"></span>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Favorite mine</td>
                                        <td class="text-right tight" data-bind="text: UndergroundController.getMineConfig($data.favoriteMine).displayName"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Discover chance</td>
                                        <td class="text-right tight" data-bind="text: $data.favoriteMineChance.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Smart tool use</td>
                                        <td class="text-right tight" data-bind="text: $data.smartToolUsageChance.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Auto-sell</td>
                                        <td class="text-right tight" data-bind="text: $data.autoSellValue.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Work cycle</td>
                                        <td class="text-right tight" data-bind="text: `${$data.workCycleTime.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })}s`"></td>
                                    </tr>
                                    </tbody>

                                    <thead>
                                    <tr>
                                        <th colspan="2" class="text-center text-light bg-dark"><h5 class="m-0">Energy Restore</h5></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td colspan="2">
                                            <div class="input-group input-group-sm">
                                                <select autocomplete="off" class="custom-select" data-bind="options: [
                                                    { name: 'None', value: -1 },
                                                    ...GameHelper.enumSelectOption(GameConstants.EnergyRestoreSize),
                                                ], optionsValue: 'value', optionsText: (item) => item.value < 0 ? `${GameConstants.camelCaseToString(item.name)}` : `${GameConstants.camelCaseToString(item.name)} (${player.itemList[item.name]().toLocaleString('en-US')})`, value: $data.selectedEnergyRestore"></select>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="card-footer p-0">
                                <button class="btn btn-block" data-bind="attr: { disabled: !$data.hired && !App.game.underground.helpers.canHire() }, css: { 'btn-success': !$data.hired, 'btn-danger': $data.hired }, click: () => !$data.hired ? $data.hire() : $data.fire(), text: !$data.hired ? 'Hire!' : 'Fire!'">Hire!</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="help" class="tab-pane fade p-2 text-left">
                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Mines</span>
                        </div>

                        <div class="card-body">
                            <p>
                                There are six different types of mines you can search for in the Underground.
                                Understanding their unique properties and the discovery times involved is crucial for efficient mining.
                            </p>

                            <h4>Mine Types</h4>
                            <ul>
                                <li>
                                    <strong>Random Mine:</strong> Contains all possible items (except the items from a Special mine)
                                </li>
                                <li>
                                    <strong>Diamond Mine:</strong> Contains only treasures sellable for diamonds.
                                </li>
                                <li>
                                    <strong>Gem Plate Mine:</strong> Contains only gem plate treasures sellable for gems.
                                </li>
                                <li>
                                    <strong>Shard Mine:</strong> Contains only shard treasures.
                                </li>
                                <li>
                                    <strong>Fossil Mine:</strong> Contains only fossils and fossil pieces.
                                </li>
                                <li>
                                    <strong>Evolution Item Mine:</strong> Contains only evolution items.
                                </li>
                            </ul>

                            <h4>Special Mine</h4>
                            <p>
                                When you (not your helper) are searching for a mine, there is a 4% chance for the mine to be a Special mine.
                                This mine only contains 1 item, which can be any of the mega stones (if eligible) or other special items.
                            </p>

                            <h4>Discovery Time Calculation</h4>
                            <p>When searching for a new specific mine or if you have not found all items in your current mine, the discovery time is calculated as follows:</p>
                            <p>
                                <code>Discovery Time = <knockout data-bind="text: GameConstants.formatTimeFullLetters(GameConstants.DISCOVER_MINE_TIMEOUT_BASE)"></knockout> - <knockout data-bind="text: GameConstants.formatTimeFullLetters(GameConstants.DISCOVER_MINE_TIMEOUT_REDUCTION_PER_LEVEL)"></knockout> x (LEVEL - <knockout data-bind="text: GameConstants.DISCOVER_MINE_TIMEOUT_LEVEL_START"></knockout>)</code>
                            </p>

                            <h4>Amount of Treasure</h4>
                            <p>The amount of treasure a player can find is random, between the minimum (inclusive) and maximum (inclusive), and increases as their Underground Level increases:</p>
                            <ul>
                                <li><strong>Minimum:</strong> Starts at 1, increases by 1 at levels: 3, 9, 15, 21 and 27, up to a maximum of 6.</li>
                                <li><strong>Maximum:</strong> Starts at 3, increases by 1 at levels: 6, 12, 18, 24 and 30, up to a maximum of 8.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Tools</span>
                        </div>

                        <div class="card-body">
                            <p>The Underground offers <knockout data-bind="text: App.game.undergroundTools.tools.length"></knockout> powerful tools to aid in your mining and exploration. Each tool has a unique function, and understanding how to use them effectively is crucial for maximizing your mining efficiency.</p>

                            <h4>Cooldown systems</h4>
                            <ul>
                                <li><strong>Tool-Specific Cooldown:</strong> Each tool has its own cooldown period that must be waited out after use if no bonus charges are available.</li>
                                <li><strong>Global Cooldown:</strong> Using any tool will trigger a brief cooldown period during which no other tool can be used.</li>
                            </ul>

                            <h4>Bonus Charges</h4>
                            <ul>
                                <li>
                                    When you use a tool, it will first check if you have any bonus charges left.
                                    <ul>
                                        <li>If you do, one charge will be consumed.</li>
                                        <li>If you don’t, the tool-specific cooldown will be triggered, followed by the global cooldown.</li>
                                    </ul>
                                </li>
                                <li>Bonus charges restore at a rate of 1 charge per X seconds, where X is equal to the tool’s base cooldown.</li>
                            </ul>

                            <h4>Successful Use</h4>
                            <p>A tool only counts as used if its action is successful, meaning it accomplishes its intended task (e.g., mining layers or indicating tiles).</p>

                            <h4>Tools Overview</h4>
                            <p>There are <knockout data-bind="text: App.game.undergroundTools.tools.length"></knockout> different tools available, each with unique functions and properties:</p>
                            <!-- ko let: { tool: App.game.undergroundTools.getTool(UndergroundToolType.Chisel) } -->
                            <div data-bind="template: { name: 'helpToolTemplate', data: { tool, action: 'Mines 2 layers on the selected spot.' } }"></div>
                            <!-- /ko -->
                            <!-- ko let: { tool: App.game.undergroundTools.getTool(UndergroundToolType.Hammer) } -->
                            <div data-bind="template: { name: 'helpToolTemplate', data: { tool, action: 'Mines 1 layer on all 9 tiles in a 3x3 grid.' } }"></div>
                            <!-- /ko -->
                            <!-- ko let: { tool: App.game.undergroundTools.getTool(UndergroundToolType.Bomb) } -->
                            <div data-bind="template: { name: 'helpToolTemplate', data: { tool, action: 'Mines a maximum of 2 layers on each of 10 random tiles (both mined and cleared). The number of tiles increases when equipped with the Explosive Charge Oak Item.' } }"></div>
                            <!-- /ko -->
                            <!-- ko let: { tool: App.game.undergroundTools.getTool(UndergroundToolType.Survey) } -->
                            <div data-bind="template: { name: 'helpToolTemplate', data: { tool, action: `Indicates a ${GameConstants.SURVEY_RANGE_BASE}x${GameConstants.SURVEY_RANGE_BASE} grid where at least one tile contains an item. The grid shrinks by two tiles on each side every ${GameConstants.SURVEY_RANGE_REDUCTION_LEVELS} levels.` } }"></div>
                            <!-- /ko -->
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Helpers</span>
                        </div>

                        <div class="card-body">
                            <p>Helpers are characters you can hire to assist with mining tasks. They perform actions at certain timing intervals and become more efficient as they level up.</p>

                            <h4>Helper Mechanics</h4>
                            <ul>
                                <li><strong>Favorite Mine:</strong> Each helper has a favorite mine they are more likely to find.
                                    <ul>
                                        <li>Starts at <knockout data-bind="text: GameConstants.FAVORITE_MINE_CHANCE_BASE.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> chance to find their favorite mine when searching.</li>
                                        <li>Increases by <knockout data-bind="text: GameConstants.FAVORITE_MINE_CHANCE_INCREASE_PER_LEVEL.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> per level, up to a maximum of <knockout data-bind="text: GameConstants.FAVORITE_MINE_CHANCE_MAXIMUM.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout>.</li>
                                        <li>If they don’t find their favorite mine, they will randomly find one of the 6 types of mines.</li>
                                    </ul>
                                </li>
                                <li><strong>Smart tool use:</strong> Helpers start out inexperienced and will pick the most efficient tool <knockout data-bind="text: GameConstants.SMART_TOOL_CHANCE_BASE.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> of the time.
                                    <ul>
                                        <li>Increases by <knockout data-bind="text: GameConstants.SMART_TOOL_CHANCE_INCREASE_PER_LEVEL.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> per level, up to <knockout data-bind="text: GameConstants.SMART_TOOL_CHANCE_MAXIMUM.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout>.</li>
                                        <li>
                                            <strong>Actions</strong>
                                            <ul>
                                                <li><strong>Bomb:</strong> When not all items have been seen.</li>
                                                <li><strong>Chisel:</strong> When all items have been seen, but not all items have been found.</li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li><strong>Auto-Sell:</strong> When a helper digs up an item that can be sold, they automatically sell it and share the profit with the player.
                                    <ul>
                                        <li>
                                            Player's share starts at <knockout data-bind="text: GameConstants.AUTO_SELL_BASE.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> and increases by <knockout data-bind="text: GameConstants.AUTO_SELL_INCREASE_PER_LEVEL.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> per level, up to <knockout data-bind="text: GameConstants.AUTO_SELL_MAXIMUM.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout>.
                                            Player's share is always rounded down.
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <strong>Work cycle:</strong> Starts at <knockout data-bind="text: GameConstants.WORKCYCLE_TIMEOUT_BASE"></knockout> seconds and decreases by <knockout data-bind="text: GameConstants.WORKCYCLE_TIMEOUT_DECREASE_PER_LEVEL"></knockout> second for every level, up to a minimum of <knockout data-bind="text: GameConstants.WORKCYCLE_TIMEOUT_MINIMUM"></knockout> seconds per action.
                                </li>
                                <li>
                                    <strong>Energy restore:</strong> A helper can use an energy potion to restore a portion of the time until they can perform their next action.
                                    <ul>
                                        <li><strong>Small restore:</strong> Restores 25% of the time until the next action can be performed</li>
                                        <li><strong>Medium restore:</strong> Restores 50% of the time until the next action can be performed</li>
                                        <li><strong>Large restore:</strong> Restores 75% of the time until the next action can be performed</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Experience and Leveling</span>
                        </div>

                        <div class="card-body">
                            <p>Using tools and helpers not only helps you gather treasures but also grants experience that helps in leveling up.</p>

                            <h4>Experience</h4>
                            <ul>
                                <li><strong>Tools:</strong> Each tool grants a certain amount of experience each time it is used successfully.
                                    <ul>
                                        <li><strong>Chisel:</strong> <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Chisel).experiencePerUse"></knockout> experience</li>
                                        <li><strong>Hammer:</strong> <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Hammer).experiencePerUse"></knockout> experience</li>
                                        <li><strong>Bomb:</strong> <knockout data-bind="text: App.game.undergroundTools.getTool(UndergroundToolType.Bomb).experiencePerUse"></knockout> experience</li>
                                    </ul>
                                </li>
                                <li>
                                    <strong>Items:</strong>
                                    <ul>
                                        <li>Digging up any item: <knockout data-bind="text: GameConstants.UNDERGROUND_EXPERIENCE_DIG_UP_ITEM"></knockout> experience</li>
                                        <li>Digging up all items: <knockout data-bind="text: GameConstants.UNDERGROUND_EXPERIENCE_CLEAR_LAYER"></knockout> experience</li>
                                    </ul>
                                </li>
                            </ul>

                            <h4>Shared Experience</h4>
                            <ul>
                                <li><strong>Player Actions:</strong> When the player performs an action that gains experience, the active helper will also gain <knockout data-bind="text: GameConstants.PLAYER_EXPERIENCE_HELPER_FRACTION.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> of that experience, rounded to the nearest tenth.</li>
                                <li><strong>Helper Actions:</strong> When the helper performs an action that gains them experience, the player will also gain <knockout data-bind="text: GameConstants.HELPER_EXPERIENCE_PLAYER_FRACTION.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> of that experience, rounded to the nearest tenth.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Trading</span>
                        </div>

                        <p>Trading allows you to exchange items within the same category. Here’s how it works:</p>
                        <ul>
                            <li><strong>Same Category Trading:</strong> Trades can only be made within the same category of items.</li>
                            <li><strong>3 to 1 Trade:</strong> Trading always follows a 3 to 1 ratio (e.g., trade 3 items to receive 1 new item).</li>
                            <li><strong>Exception:</strong> Diamond items cannot be traded.</li>
                        </ul>
                    </div>

                    <div class="card">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Oak Items</span>
                        </div>

                        <h4>Explosive Charge</h4>
                        <ul>
                            <li><strong>Progress:</strong> Gains progress to level up when finding all items in a mine</li>
                            <li><strong>Effect:</strong> Increases the number of tiles the Bomb tool will mine</li>
                        </ul>

                        <h4>Cell Battery</h4>
                        <ul>
                            <li><strong>Progress:</strong> Gains progress to level up when the player uses a tool</li>
                            <li><strong>Effect:</strong> Decreases the global cooldown timer</li>
                        </ul>

                        <h4>Treasure Scanner</h4>
                        <ul>
                            <li><strong>Progress:</strong> Gains progress to level up when finding an item in a mine</li>
                            <li><strong>Effect:</strong> Has a chance to duplicate a found item. Keeps attempting to duplicate until it fails a chance</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="modal-footer p-0">
                <div class="container">
                    <div class="row p-0">
                        <!-- ko foreach: App.game.underground.helpers.hired() -->
                        <div class="col p-0">
                            <div>
                                <span data-bind="text: $data.name"></span>
                                <!-- ko ifnot: $data.selectedEnergyRestore < 0 -->
                                <span data-bind="text: ` using ${GameConstants.camelCaseToString(GameConstants.EnergyRestoreSize[$data.selectedEnergyRestore])} (${player.itemList[GameConstants.EnergyRestoreSize[$data.selectedEnergyRestore]]().toLocaleString('en-US')})`"></span>
                                <!-- /ko -->
                            </div>
                            <div class="progress" style='height: 5px'>
                                <div class="progress-bar bg-info" role="progressbar"
                                     data-bind="attr:{ style: 'width:' + ($data.timeSinceWork / $data.workCycleTime).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }"
                                     aria-valuemin="0" aria-valuemax="100">
                                    <span data-bind="text: `${$data.timeSinceWork.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })} / ${$data.workCycleTime.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })} s`"></span>
                                </div>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/html" id="treasureListTemplate">
        <tr>
        </tr>
    </script>
</div>

<div aria-labelledby="mineSellAllTreasuresModalLabel" class="modal fade noselect" id="mineSellAllTreasuresModal" role="dialog"
     style="cursor:default" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-sm" role="document" data-bind="let: { filteredMineInventory: UndergroundItems.list.filter(item => item.hasSellValue() && player.itemList[item.itemName]()) }">
        <div class="modal-content">
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>

    <script type="text/html" id="cumulativeValueListTemplate">
        <tr></tr>
    </script>
</div>

<div aria-labelledby="findNewMineModalLabel" class="modal fade no-select" id="findNewMineModal" role="dialog" style="cursor: default;" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <h4>Select a mine</h4>
                <div class="search-mine-display mb-2">
                    <!-- ko foreach: [MineType.Random, MineType.Diamond, MineType.GemPlate, MineType.Shard, MineType.Fossil, MineType.EvolutionItem] -->
                    <div class="mx-1 mb-1">
                        <div class="card clickable" data-bind="click: () => { App.game.underground.autoSearchMineType = $data; }">
                            <div class="card-body bg-secondary rounded text-center p-1" data-bind="css: { 'bg-info': App.game.underground.autoSearchMineType === $data }">
                                <div class="d-flex flex-column align-items-center">
                                    <h6 class="card-title m-0" data-bind="text: UndergroundController.getMineConfig($data).displayName"></h6>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /ko -->
                </div>

                <div class="card mb-2">
                    <div class="card-header d-flex align-items-center p-0">
                        <span class="flex-grow-1 text-center font-weight-bold" data-bind="text: UndergroundController.getMineConfig(App.game.underground.autoSearchMineType).displayName"></span>
                    </div>

                    <div class="card-body">
                        <div class="mb-3">
                            Discovery time: <knockout data-bind="text: GameConstants.formatTime(UndergroundController.calculateDiscoverMineTimeout(App.game.underground.autoSearchMineType))"></knockout>
                        </div>

                        <h6>Potential treasures</h6>
                        <div>
                            <!-- ko foreach: UndergroundController.getMineConfig(App.game.underground.autoSearchMineType).getAvailableItems() -->
                            <img width="24px" height="24px" data-bind="tooltip: { title: $data.displayName, trigger: 'hover' }, attr: { src: $data.image }" />
                            <!-- /ko -->
                        </div>
                    </div>

                    <div class="card-footer">
                        <button class="btn btn-primary" data-bind="click: () => App.game.underground.generateMine(App.game.underground.autoSearchMineType);" data-dismiss="modal">Search for mine</button>
                    </div>
                </div>

                <div>
                    <!-- ko let: { autoRestartUndergroundMine: Settings.getSetting('autoRestartUndergroundMine') } -->
                    <label for="auto-restart-underground-mine" data-bind="text: autoRestartUndergroundMine.displayName"></label>
                    <label class="form-check-label toggler-wrapper style-1 float-right">
                        <input class="form-check-input" type="checkbox" id="auto-restart-underground-mine"
                               data-bind="checked: autoRestartUndergroundMine.observableValue">
                        <div class="toggler-slider">
                            <div class="toggler-knob"></div>
                        </div>
                    </label>
                    <!-- /ko -->
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

<div aria-labelledby="treasureDetailModalLabel" class="modal fade no-select" id="treasureDetailModal" role="dialog" style="cursor: default;" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header align-items-center">
                <!-- ko if: UndergroundTrading.selectedTradeFromItem -->
                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                <div>
                    <h4 class="m-0" data-bind="text: UndergroundTrading.selectedTradeFromItem.name"></h4>
                    <small class="m-0" data-bind="text: player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]().toLocaleString('en-US')"></small>
                </div>
                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                <!-- /ko -->
            </div>

            <div class="modal-body">
                <!-- ko if: UndergroundTrading.selectedTradeFromItem?.hasSellValue() -->
                <div class="card mb-2">
                    <div class="card-header d-flex align-items-center p-0">
                        <span class="flex-grow-1 text-center font-weight-bold">Sell</span>
                    </div>

                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 col-lg-3 font-weight-bold" data-bind="css: { 'text-danger': UndergroundTrading.sellAmount > player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() }">
                                <label data-bind="text: UndergroundTrading.sellAmount.toLocaleString('en-US')"></label>
                            </div>
                            <div class="col-12 col-lg-6">
                                <label data-bind="text: UndergroundTrading.selectedTradeFromItem.name"></label>
                                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                                →
                                <!-- ko if: UndergroundTrading.selectedTradeFromItem.valueType === UndergroundItemValueType.Gem -->
                                <img class='mineInventoryItem' data-bind='attr: { src: Gems.image(UndergroundTrading.selectedTradeFromItem.type) }'/>
                                <label data-bind="text: `${UndergroundTrading.selectedTradeFromItem.value.toLocaleString('en-US')} × ${PokemonType[UndergroundTrading.selectedTradeFromItem.type]} Gems`"></label>
                                <!-- /ko -->
                                <!-- ko if: UndergroundTrading.selectedTradeFromItem.valueType === UndergroundItemValueType.Diamond -->
                                <img class='mineInventoryItem' src="../assets/images/currency/diamond.svg"/>
                                <label data-bind="text: `${UndergroundTrading.selectedTradeFromItem.value.toLocaleString('en-US')} × Diamonds`"></label>
                                <!-- /ko -->
                            </div>
                            <div class="col-12 col-lg-3 font-weight-bold">
                                <label data-bind="text: (UndergroundTrading.sellAmount * UndergroundTrading.selectedTradeFromItem.value).toLocaleString('en-US')"></label>
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <div class="row">
                            <div class="col-12 col-lg-9 mb-2 mb-lg-0">
                                <div class="input-group">
                                    <button class="btn btn-warning btn-outline-dark smallButton smallFont" data-bind="click: () => UndergroundTrading.sellAmount = 1">Reset</button>

                                    <input type="number" class="outline-dark form-control form-control-number" data-bind="textInput: UndergroundTrading.sellAmount">

                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'original' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 10">
                                        +10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 100">
                                        +100
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'multiplication' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount *= 10">
                                        &times;10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount /= 10">
                                        &div;10
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'bigplus' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 100">
                                        +100
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 1000">
                                        +1,000
                                    </button>
                                    <!-- /ko -->

                                    <button class="btn btn-outline-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                                    <div class="dropdown-menu text-center p-0">
                                        <p class="small py-2 m-0">Set Trade Amount</p>
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [10, 100, 1000] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US')}`,
                                            click: () => { UndergroundTrading.sellAmount = $data }
                                        "></button>
                                        <!-- /ko -->
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [0.1, 0.25, 0.5, 0.75, 1] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US', { style: 'percent' })}`,
                                            click: () => { UndergroundTrading.sellAmount = player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() * $data }
                                        "></button>
                                        <!-- /ko -->
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-lg-3">
                                <button class="btn btn-block btn-primary" data-bind="
                                    enable: UndergroundTrading.canSell,
                                    click: () => UndergroundTrading.sell()
                                ">Sell</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /ko -->

                <!-- ko if: UndergroundTrading.tradeToItemList?.length > 0 -->
                <div class="card mb-2">
                    <div class="card-header d-flex align-items-center p-0">
                        <span class="flex-grow-1 text-center font-weight-bold">Trade</span>
                    </div>

                    <div class="card-body">
                        <div class="row">
                            <!-- ko foreach: UndergroundTrading.tradeToItemList -->
                            <div class="col-6 col-lg-3 mb-2" data-bind="visible: $data.isUnlocked()">
                                <div class="btn btn-secondary text-left w-100 px-1" style="cursor: default; padding-top: 1px; padding-bottom: 2px;"
                                     data-bind="
                                        css: { 'bg-info': UndergroundTrading.selectedTradeToItem === $data },
                                        template: { name: 'otherItemTemplate', data: $data.itemName },
                                        click: () => { UndergroundTrading.selectedTradeToItem = $data; }
                                     ">
                                </div>
                            </div>
                            <!-- /ko -->
                        </div>

                        <hr>

                        <div class="row">
                            <div class="col-12 col-lg-3 font-weight-bold" data-bind="css: { 'text-danger': UndergroundTrading.tradeFromAmount > player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() }">
                                <label data-bind="text: UndergroundTrading.tradeFromAmount.toLocaleString('en-US')"></label>
                            </div>
                            <div class="col-12 col-lg-6">
                                <label data-bind="text: UndergroundTrading.selectedTradeFromItem.name"></label>
                                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                                →
                                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeToItem?.image || null }'>
                                <label data-bind="text: UndergroundTrading.selectedTradeToItem?.name || '???'"></label>
                            </div>
                            <div class="col-12 col-lg-3 font-weight-bold">
                                <label data-bind="text: UndergroundTrading.tradeAmount.toLocaleString('en-US')"></label>
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <div class="row">
                            <div class="col-12 col-lg-9 mb-2 mb-lg-0">
                                <div class="input-group">
                                    <button class="btn btn-warning btn-outline-dark smallButton smallFont" data-bind="click: () => UndergroundTrading.tradeAmount = 1">Reset</button>

                                    <input type="number" class="outline-dark form-control form-control-number" data-bind="textInput: UndergroundTrading.tradeAmount">

                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'original' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 10">
                                        +10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 100">
                                        +100
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'multiplication' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount *= 10">
                                        &times;10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount /= 10">
                                        &div;10
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'bigplus' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 100">
                                        +100
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 1000">
                                        +1,000
                                    </button>
                                    <!-- /ko -->

                                    <button class="btn btn-outline-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                                    <div class="dropdown-menu text-center p-0">
                                        <p class="small py-2 m-0">Set Trade Amount</p>
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [10, 100, 1000] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US')}`,
                                            click: () => { UndergroundTrading.tradeAmount = $data }
                                        "></button>
                                        <!-- /ko -->
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [0.1, 0.25, 0.5, 0.75, 1] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US', { style: 'percent' })}`,
                                            click: () => { UndergroundTrading.tradeFromAmount = player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() * $data }
                                        "></button>
                                        <!-- /ko -->
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-lg-3">
                                <button class="btn btn-block btn-primary" data-bind="
                                    enable: UndergroundTrading.canTrade,
                                    click: () => UndergroundTrading.trade()
                                ">Trade</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /ko -->
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="helpToolTemplate">
    <h6 class="d-flex align-items-center" style="gap: 0.5rem;">
        <img alt="" data-bind="attr: { src: `../assets/images/underground/${UndergroundToolType[$data.tool.id]}.png` }">
        <knockout data-bind="text: $data.tool.displayName"></knockout>
    </h6>
    <ul>
        <li><strong>Action:</strong> <knockout data-bind="text: $data.action"></knockout></li>
        <li>
            <strong>Properties:</strong>
            <ul>
                <li><strong>Base Cooldown:</strong> <knockout data-bind="text: $data.tool.baseCooldown"></knockout> seconds</li>
                <li><strong>Cooldown Reduction per Level:</strong> <knockout data-bind="text: $data.tool.cooldownReductionPerLevel"></knockout> seconds</li>
                <li><strong>Maximum Bonus Charges:</strong> <knockout data-bind="text: $data.tool.maximumBonusCharges"></knockout> charges</li>
                <li><strong>Experience per Use:</strong> <knockout data-bind="text: $data.tool.experiencePerUse"></knockout> experience</li>
            </ul>
        </li>
    </ul>
</script>
